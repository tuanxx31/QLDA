@startuml
!pragma useUnicode true
skinparam dpi 150
skinparam sequence {
  LifeLineBorderColor #3B82F6
  LifeLineBackgroundColor #E6F2FF
  ArrowColor #000000
  ParticipantFontSize 15
  BoxFontSize 15
  ParticipantBorderColor #3B82F6
  ParticipantBackgroundColor #E6F2FF
}
hide footbox

actor "Người dùng" as User
participant ":Giao diện" as UI
participant ":Hệ thống" as System
participant ":Cơ sở dữ liệu" as DB

activate User

' === 1. Hiển thị danh sách bình luận ===
User -> UI: 1. Mở chi tiết nhiệm vụ
activate UI
UI -> System: 2. Yêu cầu danh sách bình luận
activate System
System -> DB: 3. Lấy danh sách bình luận theo nhiệm vụ
activate DB
DB --> System: Danh sách bình luận
deactivate DB
System --> UI: 4. Gửi danh sách bình luận
deactivate System
UI --> User: 5. Hiển thị bình luận
deactivate UI

' === 2. Thêm bình luận mới ===
User -> UI: 6. Nhập nội dung bình luận\n(kèm file hoặc gắn thẻ người dùng nếu có)
activate UI
UI -> System: 7. Gửi yêu cầu tạo bình luận mới
activate System
System -> DB: 8. Lưu bình luận vào cơ sở dữ liệu
activate DB
DB --> System: Đã tạo bình luận
deactivate DB

System --> UI: 9. Trả bình luận mới
deactivate System
UI --> User: 10. Hiển thị bình luận mới\n(kèm file và gắn thẻ)
deactivate UI

' === 3. Chỉnh sửa bình luận ===
User -> UI: 11. Chọn chỉnh sửa bình luận
activate UI
UI -> System: 12. Gửi yêu cầu cập nhật nội dung
activate System
System -> DB: 13. Cập nhật nội dung bình luận
activate DB
DB --> System: Đã cập nhật bình luận
deactivate DB
System --> UI: 14. Trả bình luận đã chỉnh sửa
deactivate System
UI --> User: 15. Hiển thị nội dung mới
deactivate UI

' === 4. Xóa bình luận ===
User -> UI: 16. Chọn xóa bình luận
activate UI
UI -> System: 17. Gửi yêu cầu xóa bình luận
activate System
System -> DB: 18. Xóa bình luận khỏi cơ sở dữ liệu
activate DB
DB --> System: Đã xóa bình luận
deactivate DB
System --> UI: 19. Trả kết quả xóa
deactivate System
UI --> User: 20. Loại bỏ bình luận khỏi danh sách
deactivate UI

' === 5. Hiển thị số bình luận chưa đọc ===
User -> UI: 21. Mở danh sách nhiệm vụ
activate UI
UI -> System: 22. Yêu cầu số bình luận chưa đọc
activate System
System -> DB: 23. Truy vấn số bình luận chưa đọc của người dùng
activate DB
DB --> System: Số bình luận chưa đọc
deactivate DB
System --> UI: 24. Trả dữ liệu số chưa đọc
deactivate System
UI --> User: 25. Hiển thị số lượng chưa đọc
deactivate UI

' === 6. Cập nhật trạng thái đã đọc ===
User -> UI: 26. Xem danh sách bình luận của nhiệm vụ
activate UI
UI -> System: 27. Gửi yêu cầu đánh dấu đã đọc
activate System
System -> DB: 28. Cập nhật trạng thái đã đọc
activate DB
DB --> System: Đã cập nhật
deactivate DB
System --> UI: 29. Trả kết quả cập nhật
deactivate System
UI --> User: 30. Cập nhật lại số bình luận chưa đọc
deactivate UI

' === 7. Cập nhật bình luận theo thời gian thực ===
User -> UI: 31. Đang mở màn hình bình luận
activate UI
System -> UI: 32. Gửi thông báo thời gian thực\n(thêm / sửa / xóa bình luận)
activate System
UI --> User: 33. Tự động làm mới danh sách bình luận
deactivate System
deactivate UI

deactivate User

@enduml

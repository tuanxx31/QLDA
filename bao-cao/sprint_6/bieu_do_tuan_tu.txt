@startuml
!pragma useUnicode true
skinparam dpi 150
skinparam sequence {
  LifeLineBorderColor #3B82F6
  LifeLineBackgroundColor #E6F2FF
  ArrowColor #000000
  ParticipantFontSize 15
  BoxFontSize 15
  ParticipantBorderColor #3B82F6
  ParticipantBackgroundColor #E6F2FF
}
hide footbox

actor "Người dùng" as User
participant ":Giao diện" as UI
participant ":Hệ thống" as System
participant ":Cơ sở dữ liệu" as DB

activate User

' === 1. Mở bảng điều khiển tiến độ ===
User -> UI: Mở bảng điều khiển tiến độ
activate UI
UI -> System: Yêu cầu dữ liệu tổng quan
activate System
System -> DB: Truy vấn dự án, cột, nhiệm vụ,\nngười thực hiện, hạn chót
activate DB
DB --> System: Dữ liệu thô
deactivate DB

System -> System: Tính toán tiến độ tổng,\ntiến độ theo cột, theo người,\nvà thống kê hạn chót
System --> UI: Trả dữ liệu đã xử lý
deactivate System
UI --> User: Hiển thị bảng điều khiển tiến độ
deactivate UI

' === 2. Cập nhật hạn chót dự án ===
User -> UI: Cập nhật hạn chót dự án
activate UI
UI -> System: Gửi yêu cầu cập nhật deadline
activate System
System -> DB: Cập nhật deadline vào Project
activate DB
DB --> System
deactivate DB

System -> System: Kiểm tra dự án quá hạn
System --> UI: Trả trạng thái dự án
deactivate System
UI --> User: Hiển thị trạng thái mới
deactivate UI

' === 3. Xem thống kê (gộp thành 1 nhóm) ===
User -> UI: Xem thống kê tiến độ\n(tổng, theo cột, theo người, hạn chót)
activate UI
UI -> System: Yêu cầu thống kê tương ứng
activate System
System -> DB: Truy vấn nhiệm vụ + dữ liệu liên quan
activate DB
DB --> System
deactivate DB

System -> System: Tính toán thống kê\n- Tổng tiến độ\n- Theo cột\n- Theo người\n- Tình trạng hạn chót
System --> UI: Trả dữ liệu thống kê
deactivate System
UI --> User: Hiển thị biểu đồ và bảng thống kê
deactivate UI

' === 4. Người dùng thao tác với nhiệm vụ ===
User -> UI: Thao tác nhiệm vụ\n(tạo / xóa / hoàn thành /\nđổi người / đổi hạn chót /\nkéo thả cột)
activate UI
UI -> System: Gửi yêu cầu cập nhật nhiệm vụ
activate System
System -> DB: Cập nhật nhiệm vụ
activate DB
DB --> System
deactivate DB

System -> DB: Tính lại thống kê tiến độ dự án
activate DB
DB --> System: Dữ liệu tổng hợp mới
deactivate DB

System --> UI: Trả tiến độ đã cập nhật
deactivate System
UI --> User: Cập nhật bảng điều khiển tiến độ
deactivate UI

deactivate User

@enduml

@startuml
!pragma useUnicode true
skinparam dpi 150
skinparam sequence {
  LifeLineBorderColor #3B82F6
  LifeLineBackgroundColor #E6F2FF
  ArrowColor #000000
  ParticipantFontSize 15
  BoxFontSize 15
  ParticipantBorderColor #3B82F6
  ParticipantBackgroundColor #E6F2FF
}
hide footbox

actor "Người dùng" as User
participant ":Giao diện" as UI
participant ":Hệ thống" as System
participant ":Cơ sở dữ liệu" as DB

' --- Người dùng hoạt động suốt quá trình ---
activate User

' --- Hiển thị danh sách nhiệm vụ theo cột (Kanban) ---
User -> UI: 1. Mở bảng nhiệm vụ của dự án
activate UI
UI -> System: 2. Yêu cầu danh sách cột và nhiệm vụ
activate System
System -> DB: 3. Truy vấn các cột và Task theo ProjectId
activate DB
DB --> System: [Thành công] Danh sách cột và Task
deactivate DB
System --> UI: 4. Trả dữ liệu cột và Task
deactivate System
UI --> User: 5. Hiển thị Kanban (nhiệm vụ theo từng cột)
deactivate UI

' --- Thêm nhiệm vụ mới ---
User -> UI: 6a. Chọn "Thêm nhiệm vụ" ở một cột\nnhập tiêu đề, mô tả, hạn chót
activate UI
UI -> System: 6b. Gửi yêu cầu tạo Task mới cho cột
activate System
System -> DB: 6c. Thêm bản ghi Task mới\n(gồm columnId, title, description, dueDate, priority)
activate DB
DB --> System: [Thành công]
deactivate DB
System --> UI: 6d. Trả kết quả tạo Task thành công
deactivate System
UI --> User: 6e. Hiển thị Task mới trên cột tương ứng
deactivate UI

' --- Gán nhãn cho nhiệm vụ ---
User -> UI: 7a. Mở popup nhãn của một Task\nchọn nhãn cần gán
activate UI
UI -> System: 7b. Gửi yêu cầu gán nhãn cho Task
activate System
System -> DB: 7c. Cập nhật bảng trung gian Task-Label\n(thêm hoặc xoá bản ghi)
activate DB
DB --> System: [Thành công]
deactivate DB
System --> UI: 7d. Trả kết quả gán nhãn
deactivate System
UI --> User: 7e. Cập nhật danh sách nhãn hiển thị trên Task
deactivate UI

' --- Cập nhật vị trí nhiệm vụ (kéo thả giữa các cột) ---
User -> UI: 8a. Kéo thả một Task sang vị trí mới\n(có thể khác cột)
activate UI
UI -> System: 8b. Gửi vị trí mới của Task\n(columnId mới, sortOrder mới)
activate System
System -> DB: 8c. Cập nhật columnId và sortOrder\ncủa Task trong DB
activate DB
DB --> System: [Thành công]
deactivate DB
System --> UI: 8d. Trả kết quả cập nhật vị trí
deactivate System
UI --> User: 8e. Hiển thị lại Kanban với vị trí Task mới
deactivate UI

' --- Xem chi tiết nhiệm vụ ---
User -> UI: 9a. Click vào một Task để xem chi tiết
activate UI
UI -> System: 9b. Gửi yêu cầu lấy chi tiết Task
activate System
System -> DB: 9c. Truy vấn Task, nhãn, người thực hiện,\nvà thông tin khác
activate DB
DB --> System: [Thành công] Thông tin chi tiết Task
deactivate DB
System --> UI: 9d. Trả dữ liệu chi tiết Task
deactivate System
UI --> User: 9e. Hiển thị màn hình chi tiết nhiệm vụ
deactivate UI

' --- Gán người thực hiện cho nhiệm vụ ---
User -> UI: 10a. Trong chi tiết nhiệm vụ\nchọn người thực hiện
activate UI
UI -> System: 10b. Gửi yêu cầu gán assignee cho Task
activate System
System -> DB: 10c. Cập nhật trường assigneeId của Task
activate DB
DB --> System: [Thành công]
deactivate DB
System --> UI: 10d. Trả kết quả gán người thực hiện
deactivate System
UI --> User: 10e. Hiển thị người thực hiện trên Task
deactivate UI

' --- Chỉnh sửa thông tin nhiệm vụ ---
User -> UI: 11a. Chỉnh sửa tiêu đề, mô tả, hạn chót,\nưu tiên trong chi tiết nhiệm vụ
activate UI
UI -> System: 11b. Gửi yêu cầu cập nhật Task
activate System
System -> DB: 11c. Cập nhật các trường tương ứng của Task
activate DB
DB --> System: [Thành công]
deactivate DB
System --> UI: 11d. Trả kết quả cập nhật nhiệm vụ
deactivate System
UI --> User: 11e. Hiển thị thông tin Task đã cập nhật
deactivate UI

' --- Xóa nhiệm vụ ---
User -> UI: 12a. Chọn "Xóa nhiệm vụ"
activate UI
UI -> System: 12b. Gửi yêu cầu xóa Task
activate System
System -> DB: 12c. Xóa Task và các bản ghi liên quan\n(Task-Label, comment, v.v. nếu có)
activate DB
DB --> System: [Thành công]
deactivate DB
System --> UI: 12d. Trả kết quả xóa nhiệm vụ
deactivate System
UI --> User: 12e. Loại bỏ Task khỏi bảng Kanban
deactivate UI

deactivate User

@enduml
